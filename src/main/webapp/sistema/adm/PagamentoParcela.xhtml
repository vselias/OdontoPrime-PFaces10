<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/template/Template.xhtml">

	<ui:define name="title">
		<title>Pagamento da Parcela</title>
	</ui:define>

	<ui:define name="content">
		<f:metadata>
			<f:viewParam value="#{entradaMB.consulta}" name="consulta"
				converter="ConsultaConverter" />
			<f:event listener="#{entradaMB.buscarConsultaComParcela}"
				type="preRenderView" />
		</f:metadata>

		<h:form id="frmExbParcela">

			<h3 class="tituloPagina">Pagamento da Consulta</h3>

			<ui:include src="/template/MenuPagamento.xhtml" />

			<br />
			<p:outputPanel
				style="height: 100vh !important; background-color: white;"
				id="print">

				<div class="ui-grid-responsive">

					<div class="ui-grid-row">


						<div class="ui-grid-col-2">
							<p:panel style="text-align:center;" header="Foto">
								<p:graphicImage
									rendered="#{entradaMB.consulta.paciente.nomeImagem ne null}"
									cache="false" styleClass="imagens"
									value="/imagens/#{entradaMB.consulta.paciente.nomeImagem}" />
								<p:graphicImage
									rendered="#{entradaMB.consulta.paciente.nomeImagem eq null}"
									cache="false" styleClass="imagens" value="/img/new-user.png" />
							</p:panel>
						</div>


						<div class="ui-grid-col-5">

							<p:panel header="Dados do Paciente">

								<h:panelGrid cellpadding="2" columns="2">

									<p:outputLabel value="Paciente" />
									<p:inputText size="30" readonly="true"
										value="#{entradaMB.consulta.paciente.nome}" />

									<p:outputLabel value="CPF" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.cpf}" />

									<p:outputLabel value="Dt. de Nascimento" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.dataNascimento}">
										<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
									</p:inputText>

									<p:outputLabel value="Sexo" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.sexo}" />


									<p:outputLabel value="Celular" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.celular}" />

									<p:outputLabel value="Telefone-Fixo" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.telefone}" />

									<p:outputLabel value="e-Mail" />
									<p:inputText size="30" readonly="true"
										value="#{entradaMB.consulta.paciente.email}" />

									<p:outputLabel value="Rua" />
									<p:inputText size="30" readonly="true"
										value="#{entradaMB.consulta.paciente.endereco.rua}">
									</p:inputText>
									<p:outputLabel value="Número" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.endereco.numero}" />
									<p:outputLabel value="Bairro" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.endereco.bairro}" />
									<p:outputLabel value="Estado" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.endereco.estado.descricao}" />
									<p:outputLabel value="Cidade" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.paciente.endereco.cidade}" />
								</h:panelGrid>
							</p:panel>
						</div>

						<div class="ui-grid-col-5">
							<p:panel header="Dados da Consulta">
								<h:panelGrid cellpadding="2" columns="2">

									<p:outputLabel value="Consulta" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.tipoConsulta}" />

									<p:outputLabel value="Estado da Consulta" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.estadoConsulta.descricao}" />
									<p:outputLabel value="Data da Consulta" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.dataConsulta}">
										<f:convertDateTime locale="pt_BR"
											pattern="dd/MM/yyyy HH:mm:ss" />
									</p:inputText>
									<p:outputLabel value="Data do Registro" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.entrada.dataLancamento}">
										<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
									</p:inputText>

									<p:outputLabel value="Status do Pagamento" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.entrada.estadoPagamento}" />

									<p:outputLabel value="Opção de Pagamento" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.entrada.formaPagamento.nome}" />

									<p:outputLabel value="Forma de Pagamento" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.entrada.parcela}" />

									<p:outputLabel value="Valor Total R$" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.entrada.valor}">
										<f:convertNumber pattern="R$#,##0.00" />
									</p:inputText>

									<p:outputLabel value="Desconto" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.entrada.desconto}%" />

									<p:outputLabel value="Valor com Desconto" />

									<p:inputText readonly="true"
										value="#{entradaMB.consulta.entrada.valorDesconto}">
										<f:convertNumber pattern="R$#,##0.00" />

									</p:inputText>

									<p:outputLabel value="Usuário de Registro:" />
									<p:inputText value="#{entradaMB.consulta.nomeUsuarioCadastrou}" />

									<p:outputLabel value="Status do Registro" />
									<p:inputText readonly="true"
										value="#{entradaMB.consulta.statusCadastro.descricao}" />
								</h:panelGrid>
							</p:panel>
						</div>
					</div>
				</div>
			</p:outputPanel>

			<div class="tabelaPagamentoParcela">
				<center>
					<p:dataTable size="small" tableStyle="width:auto" paginator="true"
						rowsPerPageTemplate="5,10,15"
						selection="#{entradaMB.parcelasSelecionadas}"
						selectionMode="multiple" rowKey="#{p.id}" rows="10"
						resizableColumns="true" id="tabelaParcela"
						rowStyleClass="#{p.estadoPagamento.descricao eq 'Pago'? 'destacarPagamento': ''}"
						paginatorPosition="bottom" value="#{entradaMB.entrada.parcelas}"
						var="p">
						<f:facet name="header">
							<div style="text-align: center !important;">
								<p:commandButton icon="pi pi-check" onclick="PF('dlgPagamentoTodas').show()"
									value="Pagar Parcelas" />
								<p:commandButton icon="pi pi-times" styleClass="btnCancelarPagamento"
									onclick="PF('dlgCancelPagamentoTodas').show()"
									value="Cancelar Parcelas" />
								<p:outputLabel id="duvidaPagamentoParcela" style="float: left;"
									value="AJUDA ?" />
								<p:tooltip for="duvidaPagamentoParcela"
									value="Segure shift ou control + clique esquerdo do mouse para selecionar as linhas para pagar ou cancelar as parcelas."></p:tooltip>
							</div>
						</f:facet>
						<p:column filterBy="#{entradaMB.consulta.id}" sortBy="#{entradaMB.consulta.id}" headerText="ID CONSULTA">

							<p:outputLabel value="#{entradaMB.consulta.id}" />

						</p:column>
						<p:column filterBy="#{p.valor}" sortBy="#{p.valor}"
							headerText="Valor / Parcela">

							<p:outputLabel value="#{p.valor}">
								<f:convertNumber pattern="R$#,##0.00" />
							</p:outputLabel>

						</p:column>

						<p:column filterBy="#{p.dataVencimento}"
							sortBy="#{p.dataVencimento}" headerText="Data do Vencimento">
							<p:outputLabel value="#{p.dataVencimento}">
								<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
							</p:outputLabel>
						</p:column>

						<p:column filterBy="#{p.numParcela}" sortBy="#{p.numParcela}"
							headerText="Número da Parcela">
							<p:outputLabel value="#{p.numParcela}ª" />
						</p:column>
						<p:column sortBy="#{p.estadoPagamento}"
							filterBy="#{p.estadoPagamento}"
							headerText="Status do Pagamento">
							<p:outputLabel value="#{p.estadoPagamento}" />
						</p:column>

						<p:column sortBy="#{p.dataPagamento}"
							filterBy="#{p.dataPagamento}" headerText="Data do Pagamento">
							<p:outputLabel value="#{p.dataPagamento}">
								<f:convertDateTime locale="pt_BR" timeZone="America/Sao_Paulo"
									pattern="dd/MM/yyyy" />
							</p:outputLabel>
							<p:outputLabel rendered="#{p.dataPagamento eq null}"
								value="Pendente" />
						</p:column>

					</p:dataTable>
				</center>
			</div>


		</h:form>

		<!-- dialog confirmação do pagamento de todas parcelas -->
		<p:dialog draggable="true" modal="true" widgetVar="dlgPagamentoTodas"
			header="Confirmar os pagamentos das parcelas?" closable="true"
			closeOnEscape="true" message="Deseja efetuar o registro?">
			<h:form>
				<center>
					<p:commandButton
						update=":formGlobal:msgGlobal :frmExbParcela:tabelaParcela "
						icon="pi pi-check" action="#{entradaMB.pagarParcelas}"
						oncomplete="PF('dlgPagamentoTodas').hide()" value="Sim" />
					<p:commandButton icon="pi pi-times" value="Fechar"
						oncomplete="PF('dlgPagamentoTodas').hide()" />

				</center>
			</h:form>
		</p:dialog>

		<!-- dialog confirmação do cancelamento do pagamento de todas parcelas -->
		<p:dialog draggable="true" modal="true"
			widgetVar="dlgCancelPagamentoTodas" closable="true"
			closeOnEscape="true" header="Cancelar os pagamentos das parcelas?"
			message="Deseja efetuar o registro?">
			<h:form>
				<center>
					<p:commandButton
						update=":frmExbParcela:tabelaParcela, :formGlobal:msgGlobal"
						action="#{entradaMB.cancelarPagamentosParcelas}"
						icon="pi pi-check"
						oncomplete="PF('dlgCancelPagamentoTodas').hide()" value="Sim" />
					<p:commandButton icon="pi pi-times" value="Não"
						oncomplete="PF('dlgCancelPagamentoTodas').hide()" />
				</center>
			</h:form>
		</p:dialog>


	</ui:define>
</ui:composition>

</html>